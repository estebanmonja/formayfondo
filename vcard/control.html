<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #222;
  color: white;
  padding: 20px;
}
select, input, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<h3>Profiles</h3>

<input id="newProfile" placeholder="New profile ID (e.g. 001)">
<button id="addProfile">+</button>

<select id="profileSelect"></select>

<input id="firstName" placeholder="First name">
<input id="lastName" placeholder="Last name">
<input id="role" placeholder="Role">
<input id="phone" placeholder="Phone">
<input id="email" placeholder="Email">

<button id="save">Save profile</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCuQl3fcJBIbSERG5BllWZJQxL7uIV5dHs",
  authDomain: "vcard-9a336.firebaseapp.com",
  databaseURL: "https://vcard-9a336-default-rtdb.firebaseio.com",
  projectId: "vcard-9a336",
  storageBucket: "vcard-9a336.firebasestorage.app",
  messagingSenderId: "629638484734",
  appId: "1:629638484734:web:a13eed59cc8f4949c54baf"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const selector = document.getElementById("profileSelect");
const profilesRef = ref(db, "profiles");

onValue(profilesRef, snap => {
  selector.innerHTML = "";
  snap.forEach(c => {
    const o = document.createElement("option");
    o.value = c.key;
    o.textContent = c.key;
    selector.appendChild(o);
  });
});

document.getElementById("addProfile").onclick = () => {
  const id = document.getElementById("newProfile").value.trim();
  if (!id) return;

  set(ref(db, `profiles/${id}`), {
    firstName: "",
    lastName: ""
  });

  document.getElementById("newProfile").value = "";
};

selector.onchange = loadProfile;

function loadProfile() {
  const id = selector.value;
  if (!id) return;

  onValue(ref(db, `profiles/${id}`), snap => {
    const p = snap.val();
    if (!p) return;

    firstName.value = p.firstName || "";
    lastName.value = p.lastName || "";
    role.value = p.role || "";
    phone.value = p.phone || "";
    email.value = p.email || "";
  }, { onlyOnce: true });
}

document.getElementById("save").onclick = () => {
  const id = selector.value;
  if (!id) return;

  set(ref(db, `profiles/${id}`), {
    firstName: firstName.value,
    lastName: lastName.value,
    role: role.value,
    phone: phone.value,
    email: email.value
  });
};
</script>

</body>
</html>
