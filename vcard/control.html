<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>vCard Control</title>

<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-neutral-100 min-h-screen flex items-center justify-center">

<div class="bg-white border-2 border-black p-6 w-full max-w-md">
  <h1 class="font-black text-xl mb-4">vCard Control</h1>

  <select id="profileId" class="w-full mb-4 border p-2"></select>

  <div class="flex gap-2 mb-6">
    <input id="newProfile" placeholder="New ID (e.g. 003)"
      class="border p-2 flex-1">
    <button id="addProfile"
      class="bg-[#ff0098] px-4 font-black text-white">+</button>
  </div>

  <div class="space-y-3">
    <input id="firstName" placeholder="First name" class="w-full border p-2">
    <input id="lastName" placeholder="Last name" class="w-full border p-2">
    <input id="role" placeholder="Role" class="w-full border p-2">
    <input id="company" placeholder="Company" class="w-full border p-2">
    <input id="phone" placeholder="Phone" class="w-full border p-2">
    <input id="email" placeholder="Email" class="w-full border p-2">
  </div>

  <button id="saveBtn"
    class="mt-6 w-full bg-black text-white py-3 font-black uppercase">
    Save Profile
  </button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCuQl3fcJBIbSERG5BllWZJQxL7uIV5dHs",
  authDomain: "vcard-9a336.firebaseapp.com",
  databaseURL: "https://vcard-9a336-default-rtdb.firebaseio.com",
  projectId: "vcard-9a336",
  storageBucket: "vcard-9a336.firebasestorage.app",
  messagingSenderId: "629638484734",
  appId: "1:629638484734:web:a13eed59cc8f4949c54baf"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

document.addEventListener("DOMContentLoaded", () => {
  const selector = document.getElementById("profileId");
  const fields = ["firstName","lastName","role","company","phone","email"];

  const profilesRef = ref(db, "profiles");

  onValue(profilesRef, snap => {
    selector.innerHTML = "";
    snap.forEach(child => {
      const o = document.createElement("option");
      o.value = child.key;
      o.textContent = child.key;
      selector.appendChild(o);
    });
    loadProfile();
  });

  const loadProfile = () => {
    const id = selector.value;
    if (!id) return;

    onValue(ref(db, `profiles/${id}`), snap => {
      const p = snap.val() || {};
      fields.forEach(f => {
        document.getElementById(f).value = p[f] || "";
      });
    }, { onlyOnce: true });
  };

  selector.addEventListener("change", loadProfile);

  document.getElementById("saveBtn").onclick = () => {
    const id = selector.value;
    if (!id) return alert("No profile selected");

    const data = {};
    fields.forEach(f => data[f] = document.getElementById(f).value);

    set(ref(db, `profiles/${id}`), data)
      .then(() => alert("Profile saved"))
      .catch(err => alert(err.message));
  };

  document.getElementById("addProfile").onclick = () => {
    const id = document.getElementById("newProfile").value.trim();
    if (!id) return;

    set(ref(db, `profiles/${id}`), {})
      .then(() => document.getElementById("newProfile").value = "");
  };
});
</script>

</body>
</html>
